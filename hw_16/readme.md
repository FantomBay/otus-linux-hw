
1. в вагранте поднимаем 2 машины web и log
2. на web поднимаем nginx <- 10.0.0.51
3. на log настраиваем центральный лог сервер на любой системе на выбор:

    - journald; 
    - rsyslog;

4. настраиваем аудит, следящий за изменением конфигов нжинкса  
Все критичные логи с web должны собираться и локально и удаленно.
Все логи с nginx должны уходить на удаленный сервер (локально только критичные).
Логи аудита должны также уходить на удаленную систему.  

    - развернуть еще машину elk <- 10.0.0.53  
    - таким образом настроить 2 центральных лог системы elk и какую либо еще;
    - в elk должны уходить только логи нжинкса;
    - во вторую систему все остальное  


> Формат сдачи ДЗ - vagrant + ansible

---

##### попробуем реализовать на centos8

Роли ansible:  
1.    nginx - разворачиваем nginx (из hw_10)

Для отправки логов nginx на удаленный сервер можно раешить несколькими способами:
1. настроить отрправку логов на удаленный сервер при помощи файла конфигурации самого сервера nginx.  
Для этого следует добавить в файл конфигурации веб-сервера```/etc/nginx/nginx.conf``` следующие строки:

```
http{
    ...
    access_log syslog:server={{ rsyslog.server | default("127.0.0.1") }}:{{ syslog_port | default("514") }};
    error_log syslog:server={{ rsyslog.server | default("127.0.0.1") }}:{{ syslog_port | default("514") }};
    error_log syslog:server=127.0.0.1:514 severity=critical;
    ...
}
```
подробности можно почитать [здесь](https://nginx.org/ru/docs/syslog.html)




---
Мелочи:

jourlnald - система регистрации событий в systemd. Особенности:  
- бинарный формат логов (защита от подделки*, возможна конвертация в другие форматы);
> *параметр _seal_ в осн. конфигурации.
- не требует специальной настройки
- данные структурированны (multi-field, multi-line)
> multi-line - многострочное описание одного. сообщения
> multi-field - тоже самое с полями.
- индексированные данные
- возможность централизированного сбора хранения.

Условия работы:
- сервис systemd-journald
- основной конфиг: ```/etc/systemd/journald.conf```
> после внесения изменений - перезапустить сервис  ```# systemctl restart systemd-journald```
- временное хранилище логов: ```/run/log/journal/*```
- постоянное хранилище логов: ``` /var/log/journal/* ```

Параметры конфигурации journald:
- storage - что бы писать логи на диск (а не в tmpfs) нужно установить значение в ```persistent``` после логи будут писаться в ```/var/log/journal/*```

```
journalctl --since "2021-10-27 01:11" --until "2021-10-27 10:00"
```
